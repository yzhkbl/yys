<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeethink.system.mapper.StageExamineMapper">
    <select id="findByBorrower" resultType="com.jeethink.system.domain.ZyjrBorrower">
        select id,user_name,id_card,bank_card_no,phone_number,issue_authority,start_date,end_date,family_address,obverse_id,obverse_code,obverse_address,
        obverse_name,back_id,back_code,back_address,back_name,power_id,power_code,power_address,power_name,credit_power,user_id,order_state,transaction_code
        from zyjr_borrower
        where order_state=1 and transaction_code=#{transactionCode}
    </select>
    <select id="findByRelation" resultType="com.jeethink.system.domain.ZyjrRelation">
        select id,user_name,id_card,bank_card_no,phone_number,issue_authority,start_date,end_date,family_address,company,company_address,year_income,obverse_id,
        obverse_code,obverse_address,obverse_name,back_id,back_code,back_address,back_name,power_id,power_code,power_address,power_name,credit_power,people_ship,user_id,business_role,order_state,transaction_code
        from zyjr_relation
        where order_state=1 and transaction_code=#{transactionCode}
    </select>
    <select id="findByGuarantee" resultType="com.jeethink.system.domain.ZyjrGuarantee">
        select id,user_name,id_card,bank_card_no,phone_number,issue_authority,start_date,end_date,family_address,company,company_address,year_income,obverse_id,
        obverse_code,obverse_address,obverse_name,back_id,back_code,back_address,back_name,power_id,power_code,power_address,power_name,credit_power,people_ship,user_id,order_state,transaction_code
        from zyjr_guarantee
        where order_state=1 and transaction_code=#{transactionCode}
    </select>
    <select id="findByBusiness" resultType="com.jeethink.system.domain.ZyjrBusiness">
        select a.id, a.team, a.car_information,a.false_operator,a.false_operator_id, a.intention_price, a.loan_money, a.repay_period,a. car_type,a. user_id, a.order_state,a.transaction_code,b.real_address from zyjr_business a
        left join zyjr_start_page b on a.transaction_code=b.transaction_code
        where a.order_state=1 and a.transaction_code=#{transactionCode}
    </select>
    <insert id="insertBank" parameterType="com.jeethink.system.domain.ZyjrDetails">
        insert into zyjr_details
        (id,transaction_code,details)
        values
        (#{id},#{transactionCode},#{details})
    </insert>
    <select id="findByDetails" resultType="com.jeethink.system.domain.ZyjrDetails">
        select id,transaction_code,details
        from zyjr_details
        where transaction_code=#{transactionCode}
    </select>

    <insert id="insertOpinion" parameterType="com.jeethink.system.domain.ZyjrRepeatOpinion">
        insert into zyjr_repeat_opinion
        (advise, approval_type, transaction_code, user_id)
        values
        (#{advise},#{approvalType},#{transactionCode},#{userId})
    </insert>
    <select id="findOpinion" resultType="com.jeethink.system.domain.ZyjrRepeatOpinion">
        select id, advise, approval_type, transaction_code, user_id
        from zyjr_repeat_opinion
        where transaction_code=#{transactionCode}
    </select>
    <select id="list" resultType="com.jeethink.system.domain.ZyjrBusiness">
        select a.id, a.team,a.operator,a.update_by,a.false_operator,a.false_operator_id, a.car_information, a.intention_price, a.loan_money, a.repay_period, a.car_type, a.user_id, a.order_state,a.transaction_code,b.user_name
         from zyjr_business a
         left join zyjr_borrower b on a.transaction_code=b.transaction_code
         where b.transaction_code in (select transaction_code from zyjr_allow_opinion where approval_type=1)
    </select>
</mapper>